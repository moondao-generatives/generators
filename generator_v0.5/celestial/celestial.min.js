!function(){var t,e,a,n,r,s,o,i={version:"0.7.35.s1",container:null,data:[]},l=10,c=1,p={},d={};if(i.display=function(u){var f,h=i.container,A=[],P=0,D=!1;isNumber((t=k.set(u).applyDefaults(u)).zoomextend)&&(l=t.zoomextend),isNumber(t.zoomlevel)&&(c=t.zoomlevel);var I=document.getElementById(t.container);if(I){a="#"+t.container;var L=window.getComputedStyle(I,null);parseInt(L.width)||t.width||(I.style.width=px(I.parentNode.clientWidth))}else a="body",I=null;var q=[10,10],F=getWidth(),N=isNumber(t.background.width)?F+t.background.width:F,E=window.devicePixelRatio||1,C=getProjection(t.projection,t.projectionRatio);if(C){t.lines.graticule.lat&&"outline"===t.lines.graticule.lat.pos[0]&&(C.scale-=2);var _=C.ratio,O=Math.round(F/_),B=Math.round(N/_),V=C.scale*F/1024,G=t.stars.size,H=t.dsos.size||G,U=t.stars.exponent,R=t.dsos.exponent||U,W=1,Y=getAngles(t.center),Q=t.datapath;"body"!==a&&(I.style.height=px(B)),e=i.projection(t.projection).rotate(Y).translate([N/2,B/2]).scale(V*c),n=d3.geo.zoom().projection(e).center([N/2,B/2]).scaleExtent([V,V*l]).on("zoom.redraw",redraw),V*=c;var J=d3.select(a).selectAll("canvas"),K=""!==t.culture&&"iau"!==t.culture?t.culture:"";0===J[0].length&&(J=d3.select(a).append("canvas")),J.attr("id","celestial"),J.style("width",px(N)).style("height",px(B)).attr("width",N*E).attr("height",B*E);var Z=J.node().getContext("2d");Z.setTransform(E,0,0,E,0,0);var X=d3.geo.graticule().minorStep([10,10]);r=d3.geo.path().projection(e).context(Z),h?h.selectAll(a+" *").remove():h=d3.select(a).append("container"),t.interactive?(J.call(n),d3.select(a).on("dblclick",(function(){return zoomBy(1.5625),!1}))):J.attr("style","cursor: default!important"),setClip(C.clip),d3.select(window).on("resize",resize),!0===t.interactive&&!0===t.controls&&null===$("celestial-zoomin")&&(d3.select(a).append("input").attr("type","button").attr("id","celestial-zoomin").attr("value","+").on("click",(function(){return zoomBy(1.25),!1})),d3.select(a).append("input").attr("type","button").attr("id","celestial-zoomout").attr("value","−").on("click",(function(){return zoomBy(.8),!1}))),s=d3.geo.circle().angle([90]),o=d3.geo.circle().angle([179.9]),function form(t){var e=k.set(t),n=i.projections(),r=i.eulerAngles(),s=d3.select(a+" ~ #celestial-form");s.size()<1&&(s=d3.select(a).select((function(){return this.parentNode})).append("div").attr("id","celestial-form"));var o=s.append("div").attr("class","ctrl").append("form").attr("id","params").attr("name","params").attr("method","get").attr("action","#"),l=o.append("div").attr("class","col").attr("id","general");l.append("label").attr("title","Map width in pixel, 0 indicates full width").attr("for","width").html("Width "),l.append("input").attr("type","number").attr("maxlength","4").attr("max","20000").attr("min","0").attr("title","Map width").attr("id","width").attr("value",e.width).on("change",resize),l.append("span").html("px"),l.append("label").attr("title","Map projection, (hemi) indicates hemispherical projection").attr("for","projection").html("Projection");var c=l.append("select").attr("id","projection").on("change",reproject),p=0,d=Object.keys(n).map((function(t,a){var r=n[t].clip&&!0===n[t].clip?n[t].n+" (hemi)":n[t].n;return t===e.projection&&(p=a),{o:t,n:r}}));c.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),c.property("selectedIndex",p),p=0,l.append("label").attr("title","Coordinate space in which the map is displayed").attr("for","transform").html("Coordinates"),c=l.append("select").attr("id","transform").on("change",reload),d=Object.keys(r).map((function(t,a){return t===e.transform&&(p=a),{o:t,n:t.replace(/^([a-z])/,(function(t,e){return e.toUpperCase()}))}})),c.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),c.property("selectedIndex",p),l.append("br"),l.append("label").attr("title","Center coordinates long/lat in selected coordinate space").attr("for","centerx").html("Center"),l.append("input").attr("type","number").attr("id","centerx").attr("title","Center right ascension/longitude").attr("max","24").attr("min","0").attr("step","0.1").on("change",turn),l.append("span").attr("id","cxunit").html("h"),l.append("input").attr("type","number").attr("id","centery").attr("title","Center declination/latitude").attr("max","90").attr("min","-90").attr("step","0.1").on("change",turn),l.append("span").html("°"),l.append("label").attr("title","Orientation").attr("for","centerz").html("Orientation"),l.append("input").attr("type","number").attr("id","centerz").attr("title","Center orientation").attr("max","180").attr("min","-180").attr("step","0.1").on("change",turn),l.append("span").html("°"),l.append("label").attr("for","orientationfixed").attr("class","advanced").html("Fixed"),l.append("input").attr("type","checkbox").attr("id","orientationfixed").attr("class","advanced").property("checked",e.orientationfixed).on("change",apply),l.append("label").attr("title","Center and zoom in on this constellation").attr("for","constellation").html("Show"),l.append("select").attr("id","constellation").on("change",showConstellation),setCenter(e.center,e.transform),(l=o.append("div").attr("class","col").attr("id","stars")).append("input").attr("type","checkbox").attr("id","stars-show").property("checked",e.stars.show).on("change",apply),l.append("label").attr("class","header").attr("for","stars-show").html(" Stars"),l.append("label").attr("for","stars-limit").html("down to magnitude "),l.append("input").attr("type","number").attr("id","stars-limit").attr("title","Star display limit (magnitude)").attr("value",e.stars.limit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",apply);var u=T.starnames[e.culture]||T.starnames.iau;for(var f in u)if(has(u,f)){var h=Object.keys(u[f]);h.length>1?(p=0,l.append("label").html(" "),l.append("input").attr("type","checkbox").attr("id","stars-"+f).property("checked",e.stars[f]).on("change",apply),c=l.append("select").attr("id","stars-"+f+"Type").attr("class",(function(){return"propername"===f?"advanced":""})).on("change",apply),l.append("label").attr("title","Type of star name").attr("id","label-propername").attr("for","stars-"+f+"Type").html((function(){return"propername"===f?"proper names":""})),d=h.map((function(t,a){return t===e.stars[f+"Type"]&&(p=a),{o:t,n:u[f][t]}})),c.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),c.property("selectedIndex",p)):h.length}for(f in l.append("br"),l.append("label").attr("for","stars-size").attr("class","advanced").html("Stellar disk size "),l.append("input").attr("type","number").attr("id","stars-size").attr("class","advanced").attr("title","Size of the displayed star disk; base").attr("value",e.stars.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",apply),l.append("label").attr("for","stars-exponent").attr("class","advanced").html(" * e^"),l.append("input").attr("type","number").attr("id","stars-exponent").attr("class","advanced").attr("title","Size of the displayed star disk; exponent").attr("value",e.stars.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",apply),l.append("br"),enable($form("stars-show")),(l=o.append("div").attr("class","col").attr("id","dsos")).append("input").attr("type","checkbox").attr("id","dsos-show").property("checked",e.dsos.show).on("change",apply),l.append("label").attr("class","header").attr("title","Deep Space Objects").attr("for","dsos-show").html("DSOs"),l.append("label").attr("for","dsos-limit").html("down to magnitude "),l.append("input").attr("type","number").attr("id","dsos-limit").attr("title","DSO display limit (magnitude)").attr("value",e.dsos.limit).attr("max","6").attr("min","0").attr("step","0.1").on("change",apply),u=T.dsonames[e.culture]||T.dsonames.iau)if(has(u,f)){var m=Object.keys(u[f]);p=0,l.append("label").attr("for","dsos-"+f).html(" "),l.append("input").attr("type","checkbox").attr("id","dsos-"+f).property("checked",e.dsos[f]).on("change",apply),l.append("label").attr("title","Type of DSO name").attr("for","dsos-"+f+"Type").attr("class","advanced").html(""),c=l.append("select").attr("id","dsos-"+f+"Type").attr("class","advanced").on("change",apply),d=m.map((function(t,a){return t===e.stars[f+"Type"]&&(p=a),{o:t,n:u[f][t]}})),c.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),c.property("selectedIndex",p)}for(f in l.append("br"),l.append("br"),l.append("label").attr("class","advanced").html(" * * * * * "),enable($form("dsos-show")),(l=o.append("div").attr("class","col").attr("id","constellations")).append("label").attr("class","header").html("Constellations"),u=T.constellations[e.culture]||T.constellations.iau)if(has(u,f)){var y=Object.keys(u[f]);y.length>1?(p=0,l.append("label").attr("title","Language of constellation names").attr("for","constellations-"+f+"Type").attr("class","advanced").html(""),c=l.append("select").attr("id","constellations-"+f+"Type").attr("class","advanced").on("change",apply),d=y.map((function(t,a){return t===e.constellations[f+"Type"]&&(p=a),{o:t,n:u[f][t]}})),c.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),c.property("selectedIndex",p),l.append("label").attr("for","constellations-"+f).html("names"),l.append("input").attr("type","checkbox").attr("id","constellations-"+f).property("checked",e.constellations[f]).on("change",apply)):1===y.length&&(l.append("label").attr("for","constellations-"+f).attr("class","advanced").html(" "+u[f][y[0]]),l.append("input").attr("type","checkbox").attr("id","constellations-"+f).attr("class","advanced").property("checked",e.constellations[f]).on("change",apply))}l.append("label").attr("for","constellations-lines").html(" lines"),l.append("input").attr("type","checkbox").attr("id","constellations-lines").property("checked",e.constellations.lines).on("change",apply),l.append("label").attr("for","constellations-bounds").html(" boundaries"),l.append("input").attr("type","checkbox").attr("id","constellations-bounds").property("checked",e.constellations.bounds).on("change",apply),enable($form("constellations-names")),(l=o.append("div").attr("class","col").attr("id","lines")).append("label").attr("class","header").html("Lines"),l.append("label").attr("title","Latitude/longitude grid lines").attr("for","lines-graticule").html("Graticule"),l.append("input").attr("type","checkbox").attr("id","lines-graticule-show").property("checked",e.lines.graticule.show).on("change",apply),l.append("label").attr("for","lines-equatorial").html("Equator"),l.append("input").attr("type","checkbox").attr("id","lines-equatorial-show").property("checked",e.lines.equatorial.show).on("change",apply),l.append("label").attr("for","lines-ecliptic").html("Ecliptic"),l.append("input").attr("type","checkbox").attr("id","lines-ecliptic-show").property("checked",e.lines.ecliptic.show).on("change",apply),l.append("label").attr("for","lines-galactic").html("Galactic plane"),l.append("input").attr("type","checkbox").attr("id","lines-galactic-show").property("checked",e.lines.galactic.show).on("change",apply),l.append("label").attr("for","lines-supergalactic").html("Supergalactic plane"),l.append("input").attr("type","checkbox").attr("id","lines-supergalactic-show").property("checked",e.lines.supergalactic.show).on("change",apply),(l=o.append("div").attr("class","col").attr("id","other")).append("label").attr("class","header").html("Other"),l.append("label").attr("for","mw-show").html("Milky Way"),l.append("input").attr("type","checkbox").attr("id","mw-show").property("checked",e.mw.show).on("change",apply),l.append("label").attr("for","mw-style-fill").attr("class","advanced").html(" color"),l.append("input").attr("type","color").attr("id","mw-style-fill").attr("class","advanced").attr("title","Milky Way color").attr("value",e.mw.style.fill).on("change",apply),l.append("label").attr("for","mw-style-opacity").attr("class","advanced").html(" opacity"),l.append("input").attr("type","number").attr("id","mw-style-opacity").attr("class","advanced").attr("title","Transparency of each Milky Way layer").attr("value",e.mw.style.opacity).attr("max","1").attr("min","0").attr("step","0.01").on("change",apply),l.append("label").attr("for","advanced").html("Advanced options"),l.append("input").attr("type","checkbox").attr("id","advanced").property("checked",e.advanced).on("change",apply),l.append("br"),l.append("label").attr("for","background-fill").html("Background color"),l.append("input").attr("type","color").attr("id","background-fill").attr("title","Background color").attr("value",e.background.fill).on("change",apply),l.append("label").attr("for","background-opacity").attr("class","advanced").html("opacity"),l.append("input").attr("type","number").attr("id","background-opacity").attr("class","advanced").attr("title","Background opacity").attr("value",e.background.opacity).attr("max","1").attr("min","0").attr("step","0.01").on("change",apply),l.append("label").attr("title","Star/DSO sizes are increased with higher zoom-levels").attr("for","adaptable").attr("class","advanced").html("Adaptable object sizes"),l.append("input").attr("type","checkbox").attr("id","adaptable").attr("class","advanced").property("checked",e.adaptable).on("change",apply);var g=z[e.culture];function resize(){var t=this,a=t.value;!1!==testNumber(t)&&(e.width=a,i.resize({width:a}))}function reload(){var t=this.value,a=setUnit(t,e.transform);null!==a&&(e.center[0]=a),e.transform=t,k.set(e),i.reload(e)}function reproject(){var t=this;t&&(e.projection=t.value,k.set(e),i.reproject(e))}function turn(){!1!==testNumber(this)&&!1!==getCenter()&&i.rotate(e)}function getCenter(){var t=$form("centerx"),a=$form("centery"),n=$form("centerz");if(t&&a){if("equatorial"!==e.transform)e.center[0]=parseFloat(t.value);else{var r=parseFloat(t.value);e.center[0]=r>12?15*r-360:15*r}e.center[1]=parseFloat(a.value);var s=parseFloat(n.value);return e.center[2]=isNaN(s)?0:s,""!==t.value&&""!==a.value}}function getFilename(t){var e=d3.time.format("%Y%m%dT%H%M%S%Z"),a="d3-celestial",n=i.date();return n&&(a+=e(n)),a+t}function showConstellation(){var t=this.value;t&&showCon(t)}function showCon(t){var e,a=[],n=w;if("---"===t)return i.constellation=null,1!==(e=i.zoomBy())&&a.push({param:"zoom",value:1/e,duration:0}),void i.animate(a,!1);if(function isObject(t){var e=typeof t;return"function"===e||"object"===e&&!!t}(i.constellations)&&has(i.constellations,t)){var r=i.constellations[t],s=transformDeg(r.center,b[n.transform]);n.center=s,setCenter(n.center,n.transform),1!==(e=i.zoomBy())&&a.push({param:"zoom",value:1/e,duration:0}),a.push({param:"center",value:s,duration:0});var o=1+360/r.scale;a.push({param:"zoom",value:o,duration:0}),i.constellation=t,i.animate(a,!1)}}function apply(){var t,a=this;switch(Object.assign(e,k.set()),a.type){case"checkbox":t=a.checked,enable(a);break;case"number":if(!1===testNumber(a))return;t=parseFloat(a.value);break;case"text":if(-1===a.id.search(/fill$/))return;if(!1===testColor(a))return;t=a.value;break;case"select-one":t=a.value}null!==t&&(set(a.id,t),"dsos-style-fill"===a.id?(set("dsos-style-stroke",t),set("dsos-nameStyle-fill",t)):"constellations-namesType"===a.id?listConstellations():"lang"===a.id?setLanguage(t):"advanced"===a.id&&showAdvanced(t),getCenter(),Object.assign(w,e),i.apply(e))}function set(t,a){var n=t.split("-");switch(n.length){case 1:e[n[0]]=a;break;case 2:e[n[0]][n[1]]=a;break;case 3:e[n[0]][n[1]][n[2]]=a;break;default:return}}function setLanguage(t){Object.assign(e,w),e.lang=t;for(var a=["constellations","planets"],n=0;n<a.length;n++)has(T[a[n]][e.culture].names,t)?e[a[n]].namesType=t:has(T[a[n]][e.culture].names,"desig")?e[a[n]].namesType="desig":e[a[n]].namesType="name";return has(T.dsonames[e.culture].names,t)?e.dsos.namesType=t:e.dsos.namesType="desig",has(T.starnames[e.culture].propername,t)?e.stars.propernameType=t:e.stars.propernameType="desig",Object.assign(w,e),update(),listConstellations(),e}function update(){d3.selectAll(a+" ~ #celestial-form input, "+a+" ~  #celestial-form select").each((function(t,a){if(this!==undefined){var n=this.id;if("lat"===n||"lon"===n)isArray(e.geopos)&&(this.value="lat"===n?e.geopos[0]:e.geopos[1]);else if(-1!==n.search(/center/)){if(isArray(e.center))switch(n){case"centerx":this.value=e.center[0];break;case"centery":this.value=e.center[1];break;case"centerz":this.value=e.center[2]||0}}else{if("datetime"===n||"hr"===n||"min"===n||"sec"===n||"tz"===n)return;if("button"!==this.type){var r=get(n);switch(this.type){case"checkbox":this.checked=r,enable(n);break;case"number":if(!1===testNumber(this))break;this.value=parseFloat(get(n));break;case"color":if(!1===testColor(this))break;this.value=r;break;case"text":if(-1===n.search(/fill$/))break;if(!1===testColor(this))break;this.value=r;break;case"select-one":this.value=r}}}}}))}function get(t){var a=t.split("-");switch(a.length){case 1:return e[a[0]];case 2:return e[a[0]][a[1]];case 3:return e[a[0]][a[1]][a[2]];default:return}}p=0,l.append("label").attr("title","General language setting").attr("for","lang").html("Object names "),c=l.append("select").attr("id","lang").on("change",apply),d=g.map((function(t,a){return t===e.lang&&(p=a),{o:t,n:T.constellations[e.culture].names[t]}})),d=[{o:"---",n:"(Select language)"}].concat(d),c.selectAll("option").data(d).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),c.property("selectedIndex",p),(l=o.append("div").attr("class","col").attr("id","download")).append("label").attr("class","header").html("Download"),l.append("input").attr("type","button").attr("id","download-png").attr("value","PNG Image").on("click",(function(){var t=d3.select("body").append("a").node(),e=document.querySelector(a+" canvas");t.download=getFilename(".png"),t.rel="noopener",t.href=e.toDataURL("image/png").replace("image/png","image/octet-stream"),t.click(),d3.select(t).remove()})),l.append("input").attr("type","button").attr("id","download-svg").attr("value","SVG File").on("click",(function(){return exportSVG(getFilename(".svg")),!1})),function setLimits(){var t,e,a,n=/\d+(\.\d+)?/g,r={s:6,d:6},s=i.settings();a=s.dsos.data,null!==(t=a.match(n))&&(r.d=parseFloat(t[t.length-1]));6!==r.d&&($form("dsos-limit").max=r.d,$form("dsos-nameLimit").max=r.d);e=s.stars.data,null!==(t=e.match(n))&&(r.s=parseFloat(t[t.length-1]));6!=r.s&&($form("stars-limit").max=r.s,$form("stars-designationLimit").max=r.s,$form("stars-propernameLimit").max=r.s);return r}(),setUnit(e.transform),function setVisibility(t,e){var n,r;if(!has(t,"formFields"))return;if(e&&has(t.formFields,e))return void d3.select(a+" ~ #celestial-form").select("#"+e).style({display:"none"});if(!1===t.form&&!0===t.location){for(r in d3.select(a+" ~ #celestial-form").style("display","inline-block"),t.formFields)has(t.formFields,r)&&"location"!==r&&d3.select(a+" ~ #celestial-form").select("#"+r).style({display:"none"});return}!1===t.form&&d3.select(a+" ~ #celestial-form").style("display","none");for(r in t.formFields)has(t.formFields,r)&&"location"!==r&&(n=!1===t.formFields[r]?"none":"block",d3.select(a+" ~ #celestial-form").select("#"+r).style({display:n}))}(t),showAdvanced(e.advanced),i.updateForm=update,i.showConstellation=showCon,i.setLanguage=function(t){var a=k.set();return-1!==z[e.culture].indexOf(t)&&(a=setLanguage(t)),a}}(t),null===$("error")&&d3.select("body").append("div").attr("id","error"),null===$("loc")?function geo(t){var e=d3.time.format("%Y-%m-%d %H:%M:%S"),n=[0,0],r=[7.1315,171.1845],s=new Date,o=-s.getTimezoneOffset(),l=o,c=k.set(t),p=d3.select(a+" ~ #celestial-form form").insert("div","div#general").attr("id","loc"),d=new datetimepicker(c,(function(t,e){$form("datetime").value=dateFormat(t,e),l=e,go()}));has(c,"geopos")&&null!==c.geopos&&2===c.geopos.length&&(r=c.geopos);var u=p.append("div").attr("class","col").attr("id","location").style("display","none");u.append("label").attr("title","Location coordinates long/lat").attr("for","lat").html("Location "),u.append("input").attr("type","number").attr("id","lat").attr("title","Latitude").attr("placeholder","Latitude").attr("max","90").attr("min","-90").attr("step","0.0001").attr("value",r[0]).on("change",(function(){!0===testNumber(this)&&go()})),u.append("span").html("°"),u.append("input").attr("type","number").attr("id","lon").attr("title","Longitude").attr("placeholder","Longitude").attr("max","180").attr("min","-180").attr("step","0.0001").attr("value",r[1]).on("change",(function(){!0===testNumber(this)&&go()})),u.append("span").html("°"),"geolocation"in navigator&&u.append("input").attr("type","button").attr("value","HERE").attr("id","here").on("click",here);u.append("label").attr("title","Local date/time").attr("for","datetime").html(" Date/time "),u.append("input").attr("type","button").attr("id","day-left").attr("title","One day back").on("click",(function(){s.setDate(s.getDate()-1),$form("datetime").value=dateFormat(s,l),go()})),u.append("input").attr("type","text").attr("id","datetime").attr("title","Date and time").attr("value",dateFormat(s,l)).on("click",showpick,!0).on("input",(function(){this.value=dateFormat(s,l),d.isVisible()||showpick()})),u.append("div").attr("id","datepick").on("click",showpick),u.append("input").attr("type","button").attr("id","day-right").attr("title","One day forward").on("click",(function(){s.setDate(s.getDate()+1),$form("datetime").value=dateFormat(s,l),go()})),u.append("input").attr("type","button").attr("value","NOW").attr("id","now").on("click",now),u.append("br"),u.append("br"),u.append("input").attr("type","checkbox").attr("id","planets-show").property("checked",c.planets.show).on("change",apply),u.append("label").attr("title","Show solar system objects").attr("for","planets-show").html(" Planets, Sun and Moon");var f=T.planets[c.culture]||T.planets.iau;for(var h in f)if(has(f,h)){var m=Object.keys(f[h]);if(m.length>1){var y="symbol"===h?"as":" ";u.append("label").attr("for","planets-"+h+"Type").html(y),"names"===h&&u.append("input").attr("type","checkbox").attr("id","planets-"+h).property("checked",c.planets[h]).on("change",apply);var g=0;u.append("label").attr("title","Type of planet name").attr("for","planets-"+h+"Type").attr("class","advanced").html("");var v=u.append("select").attr("id","planets-"+h+"Type").on("change",apply),b=m.map((function(t,e){return t===c.planets[h+"Type"]&&(g=e),{o:t,n:f[h][t]}}));v.selectAll("option").data(b).enter().append("option").attr("value",(function(t){return t.o})).text((function(t){return t.n})),v.property("selectedIndex",g)}}function now(){s.setTime(Date.now()),$form("datetime").value=dateFormat(s,l),go()}function here(){navigator.geolocation.getCurrentPosition((function(t){r=[Round(t.coords.latitude,4),Round(t.coords.longitude,4)],$form("lat").value=r[0],$form("lon").value=r[1],go()}))}function showpick(){d.show(s,l)}function dateFormat(t,a){var n;if(a&&"0"!==a){var r=Math.floor(Math.abs(a)/60),s=Math.abs(a)-60*r;n=(a>0?" +":" −")+pad(r)+pad(s)}else n=" ±0000";return e(t)+n}function isValidLocation(t){return!(!t||!isArray(t)||t.length<2)&&(!(!isNumber(t[0])||t[0]<-90||t[0]>90)&&!(!isNumber(t[1])||t[1]<-180||t[1]>180))}function isValidTimezone(t){return t!==undefined&&null!==t&&!(!isNumber(t)&&Math.abs(t)>840)}function apply(){Object.assign(c,k.set()),c.planets.show=!!$form("planets-show").checked,c.planets.names=!!$form("planets-names").checked,c.planets.namesType=$form("planets-namesType").value,c.planets.symbolType=$form("planets-symbolType").value,enable($form("planets-show")),i.apply(c)}function go(){var t=parseFloat($form("lon").value),a=parseFloat($form("lat").value);if(Object.assign(c,k.set()),s=e.parse($form("datetime").value.slice(0,-6)),!isNaN(t)&&!isNaN(a)){if(a!==r[0]||t!==r[1])return r=[a,t],void setPosition([a,t],!0);$form("datetime").value=dateFormat(s,l);var p=new Date(s.valueOf()-6e4*(l-o));(n=i.getPoint(horizontal.inverse(p,[90,0],r),c.transform))[2]=0,"zenith"===c.follow?i.rotate({center:n}):i.redraw()}}function setPosition(t,e){if(t&&has(c,"settimezone")&&!1!==c.settimezone){var a=Math.floor(s.getTime()/1e3),n=(window&&"https:"===window.location.protocol?"https":"http")+"://api.timezonedb.com/v2.1/get-time-zone?key="+c.timezoneid+"&format=json&by=position&lat="+t[0]+"&lng="+t[1]+"&time="+a;d3.json(n,(function(e,n){if(e)return console.warn(e);"FAILED"===n.status?(l=60*Math.round(t[1]/15),{gmtOffset:60*l,message:"Sea locatation inferred",timestamp:a}):(l=n.gmtOffset/60,n),$form("datetime").value=dateFormat(s,l),go()}))}}u.append("br"),enable($form("planets-show")),showAdvanced(c.advanced),d3.select(document).on("mousedown",(function(){!function hasParent(t,e){for(;t.parentNode;){if(t.id===e)return!0;t=t.parentNode}return!1}(d3.event.target,"celestial-date")&&d.isVisible()&&d.hide()})),i.dateFormat=dateFormat,i.date=function(t,e){if(!t)return s;isValidTimezone(e)&&(l=e),Object.assign(c,k.set()),d.isVisible()&&d.hide(),s.setTime(t.valueOf()),$form("datetime").value=dateFormat(t,l),go()},i.timezone=function(t){if(!t)return l;isValidTimezone(t)&&(l=t),Object.assign(c,k.set()),d.isVisible()&&d.hide(),$form("datetime").value=dateFormat(s,l),go()},i.position=function(){return r},i.location=function(t,e){if(!t||t.length<2)return r;isValidLocation(t)&&(r=t.slice(),$form("lat").value=r[0],$form("lon").value=r[1],isValidTimezone(e)?l=e:setPosition(r,!0))},i.skyview=function(t){if(!t)return{date:s,location:r,timezone:l};var e=!1;if(d.isVisible()&&d.hide(),has(t,"timezone")&&isValidTimezone(t.timezone)&&(l=t.timezone,e=!0),has(t,"date")&&function isValidDate(t){return t&&t instanceof Date&&!isNaN(t)}(t.date)&&(s.setTime(t.date.valueOf()),$form("datetime").value=dateFormat(t.date,l),e=!0),!has(t,"location")||!isValidLocation(t.location)||(r=t.location.slice(),$form("lat").value=r[0],$form("lon").value=r[1],has(t,"timezone")))return!1===e?{date:s,location:r,timezone:l}:void("zenith"===c.follow?go():i.redraw());setPosition(r,!has(t,"date"))},i.dtLoc=i.skyview,i.zenith=function(){return n},i.nadir=function(){var t=-n[1],e=n[0]+180;return e>180&&(e-=360),[e,t-.001]},!has(c,"formFields")||!0!==c.location&&!0!==c.formFields.location||d3.select(a+" ~ #celestial-form").select("#location").style({display:"inline-block"});!isValidLocation(r)||!0!==c.location&&!0!==c.formFields.location||"zenith"!==c.follow||setTimeout(go,1e3)}(t):!0===t.location&&"zenith"===t.follow&&rotate({center:i.zenith()}),!0!==t.location&&!0!==t.formFields.location||(d3.select(a+" #location").style("display","inline-block"),fldEnable("horizon-show",C.clip),fldEnable("daylight-show",!C.clip)),this.container=h,this.clip=clip,this.map=r,this.mapProjection=e,this.context=Z,this.metrics=function(){return{width:F,height:O,margin:q,scale:e.scale()}},this.setStyle=setStyle,this.setTextStyle=setTextStyle,this.setStyleA=setStyleA,this.setConstStyle=function(t,e){var a=arrayfy(e);Z.font=a[t]},this.symbol=j.symbol,this.dsoSymbol=dsoSymbol,this.redraw=redraw,this.resize=function(e){return e!==undefined&&(has(e,"width")?t.width=e.width:isNumber(e)&&(t.width=e)),resize(!0),t.width},this.reload=function(n){var r;n&&Object.assign(t,k.set(n)),"center"===t.follow&&has(t,"center")?r=getAngles(t.center):"zenith"===t.follow&&(r=getAngles(i.zenith())),r&&e.rotate(r),h.selectAll(a+" *").remove(),load()},this.apply=function(t){apply(t)},this.reproject=function(t){return reproject(t)},this.rotate=function(e){return e?rotate(e):t.center},this.zoomBy=function(t){return t?zoomBy(t):e.scale()/V},this.color=function(e){return e&&has(t.dsos.symbols,e)?t.dsos.symbols[e].fill:"#000"},this.starColor=starColor,this.animate=function(t,e){t&&(A=t,P=0,D=!!e,animate())},this.stop=function(t){!function stop(){clearTimeout(f)}(),!0===t&&(A=[])},this.go=function(t){A.length<1||(t&&t<A.length&&(P=t),animate())},load()}function load(){for(var e in setClip(C.clip),h.append("path").datum(X.outline).attr("class","outline"),h.append("path").datum(s).attr("class","horizon"),h.append("path").datum(o).attr("class","daylight"),"equatorial"===t.transform?X.minorStep([15,10]):X.minorStep([10,10]),t.lines)has(t.lines,e)&&("graticule"===e?(h.append("path").datum(X).attr("class","graticule"),has(t.lines.graticule,"lon")&&t.lines.graticule.lon.pos.length>0&&h.selectAll(a+" .gridvalues_lon").data(getGridValues("lon",t.lines.graticule.lon.pos)).enter().append("path").attr("class","graticule_lon"),has(t.lines.graticule,"lat")&&t.lines.graticule.lat.pos.length>0&&h.selectAll(a+" .gridvalues_lat").data(getGridValues("lat",t.lines.graticule.lat.pos)).enter().append("path").attr("class","graticule_lat")):h.append("path").datum(d3.geo.circle().angle([90]).origin(transformDeg(m[e],b[t.transform]))).attr("class",e));d3.json(Q+"mw.json",(function(e,n){if(e)return window.alert("Data file could not be loaded or doesn't exist. See readme.md"),console.warn(e);var r=getData(n,t.transform),s=getMwbackground(r);h.selectAll(a+" .mway").data(r.features).enter().append("path").attr("class","mw"),h.selectAll(a+" .mwaybg").data(s.features).enter().append("path").attr("class","mwbg"),redraw()})),d3.json(Q+filename("constellations"),(function(e,n){if(e)return console.warn(e);var r=getData(n,t.transform);h.selectAll(a+" .constnames").data(r.features).enter().append("text").attr("class","constname"),i.constellations=function getConstellationList(t){for(var e={},a=t.features,n=0;n<a.length;n++)e[a[n].id]={center:a[n].properties.display.slice(0,2),scale:a[n].properties.display[2]};return e}(r),redraw()})),d3.json(Q+filename("constellations","borders"),(function(e,n){if(e)return console.warn(e);var r=getData(n,t.transform);h.selectAll(a+" .bounds").data(r.features).enter().append("path").attr("class","boundaryline"),redraw()})),d3.json(Q+filename("constellations","lines"),(function(e,n){if(e)return console.warn(e);var r=getData(n,t.transform);h.selectAll(a+" .lines").data(r.features).enter().append("path").attr("class","constline"),listConstellations(),redraw()})),d3.json(Q+t.stars.data,(function(e,n){if(e)return console.warn(e);var r=getData(n,t.transform);h.selectAll(a+" .stars").data(r.features).enter().append("path").attr("class","star"),redraw()})),d3.json(Q+filename("starnames"),(function(t,e){if(t)return console.warn(t);Object.assign(p,e),redraw()})),d3.json(Q+t.dsos.data,(function(e,n){if(e)return console.warn(e);var r=getData(n,t.transform);h.selectAll(a+" .dsos").data(r.features).enter().append("path").attr("class","dso"),redraw()})),d3.json(Q+filename("dsonames"),(function(t,e){if(t)return console.warn(t);Object.assign(d,e),redraw()})),d3.json(Q+filename("planets"),(function(e,n){if(e)return console.warn(e);var r=function getPlanets(e){var a=[];for(var n in e)if(has(e,n)&&-1!==t.planets.which.indexOf(n)){var r=Kepler().id(n);has(e[n],"parent")&&r.parentBody(e[n].parent),r.elements(e[n].elements[0]).params(e[n]),"ter"===n?i.origin=r:a.push(r)}return a}(n,t.transform);h.selectAll(a+" .planets").data(r).enter().append("path").attr("class","planet"),redraw()})),i.data.length>0&&i.data.forEach((function(t){has(t,"file")?d3.json(t.file,t.callback):setTimeout(t.callback,0)}),this),t.lang&&""!=t.lang&&apply(i.setLanguage(t.lang))}function zoomBy(a){if(a&&1!==a){var r=e.scale(),s=r*a,o=n.scaleExtent(),i=1e3*Math.sqrt(Math.abs(1-a));if(s<o[0]&&(s=o[0]),s>o[1]&&(s=o[1]),!0===t.disableAnimations)return e.scale(s),n.scale(s),redraw(),0;var l=d3.interpolateNumber(r,s);return d3.select({}).transition().duration(i).tween("scale",(function(){return function(t){var a=l(t);e.scale(a),redraw()}})).transition().duration(0).tween("scale",(function(){n.scale(s),redraw()})),i}}function apply(e){t=k.set(e),redraw()}function rotate(a){var n,r,s,o=t.center,i=e.rotate(),l=e.scale(),c=4200,p=!1,d=t.orientationfixed;Round(i[1],1)===-Round(a.center[1],1)&&(p=!0),t=t.set(a);var u=Round(d3.geo.distance(o,t.center),2),f=d3.geo.distance([o[2],0],[t.center[2],0]);return u<.035&&f<.035||!0===t.disableAnimations?(Y=getAngles(t.center),e.rotate(Y),redraw(),0):(r=l>1.4*V?d3.interpolateNumber(l,V):function(){return l},s=0===f?function(){return i[2]}:function interpolateAngle(t,e,a){t=(t*v+y)%y,e=(e*v+y)%y,Math.abs(t-e)>Math.PI&&(t>e?t-=y:e>t&&(e-=y));return d3.interpolateNumber(t/v,e/v)}(o[2],t.center[2]),u>3.14&&(t.center[0]-=.01),t.orientationfixed=!1,n=0===u?function(){return t.center}:d3.geo.interpolate(o,t.center),c=0!==u?c*u:c*f,d3.select({}).transition().duration(c).tween("center",(function(){return function(t){var a=getAngles(n(t));a[2]=s(t);var o=r(t<.5?t:1-t);p&&(a[1]=i[1]),e.scale(o),e.rotate(a),redraw()}})).transition().duration(0).tween("center",(function(){t.orientationfixed=d,Y=getAngles(t.center),e.rotate(Y),redraw()})),c)}function resize(a){F=getWidth(),(t.width!==F||a)&&(O=F/_,N=isNumber(t.background.width)?F+t.background.width:F,B=Math.round(N/_),V=C.scale*F/1024,J.style("width",px(N)).style("height",px(B)).attr("width",N*E).attr("height",B*E),n.scaleExtent([V,V*l]).scale(V*c),e.translate([N/2,B/2]).scale(V*c),I&&(I.style.height=px(O)),V*=c,redraw())}function reproject(a){var s=getProjection(a.projection,a.projectionRatio);if(s){var o=e.rotate(),p=e.center(),d=e.scale(),u=n.scaleExtent(),f=i.projection(t.projection).center(p).translate([N/2,B/2]).scale([u[0]]),h=4e3,m=0,y=d3.interpolateNumber(_,s.ratio);C.clip==s.clip&&!0!==t.disableAnimations||(h=0),setClip(s.clip);var g=i.projection(a.projection).center(p).translate([N/2,N/s.ratio/2]).scale([s.scale*F/1024]),v=t.adaptable;return d>u[0]?(m=zoomBy(.1),setTimeout(reproject,m,a),m+h):(e=function projectionTween(t,e){var a,n=d3.geo.projection(raw).scale(1),r=n.center,s=n.translate;function raw(n,r){var s=t([n*=180/Math.PI,r*=180/Math.PI]),o=e([n,r]);return[(1-a)*s[0]+a*o[0],(a-1)*s[1]-a*o[1]]}return n.alpha=function(o){if(!arguments.length)return a;a=+o;var i=t.center(),l=e.center(),c=t.translate(),p=e.translate();return r([(1-a)*i[0]+a*l[0],(1-a)*i[1]+a*l[1]]),s([(1-a)*c[0]+a*p[0],(1-a)*c[1]+a*p[1]]),n},delete n.translate,delete n.center,n.alpha(0)}(f,g),t.adaptable=!1,d3.select({}).transition().duration(h).tween("projection",(function(){return function(t){e.alpha(t).rotate(o),r.projection(e),setClip(s.clip),_=y(t),O=F/_,J.style("width",px(N)).style("height",px(B)).attr("width",N*E).attr("height",B*E),I&&(I.style.height=px(B)),redraw()}})).transition().duration(0).tween("projection",(function(){_=(C=s).ratio,O=F/C.ratio,B=isNumber(t.background.width)?O+t.background.width:O,V=C.scale*F/1024,J.style("width",px(N)).style("height",px(B)).attr("width",N*E).attr("height",B*E),I&&(I.style.height=px(B)),t.projection=a.projection,e=i.projection(a.projection).rotate(o).translate([N/2,B/2]).scale(V*c),r.projection(e),setClip(C.clip),n.projection(e).scaleExtent([V,V*l]).scale(V*c),t.adaptable=v,V*=c,redraw()})),h)}}function redraw(){var n=e.rotate();for(var c in Z.setTransform(E,0,0,E,0,0),t.adaptable&&(W=Math.sqrt(e.scale()/V)),W||(W=1),G=t.stars.size,U=t.stars.exponent,H=t.dsos.size||G,R=t.dsos.exponent,t.orientationfixed&&t.center.length>2&&(n[2]=t.center[2],e.rotate(n)),t.center=[-n[0],-n[1],n[2]],setCenter(t.center,t.transform),function clear(){Z.clearRect(0,0,N+q[0],B+q[1])}(),drawOutline(),t.mw.show&&(h.selectAll(a+" .mw").each((function(e){setStyle(t.mw.style),r(e),Z.fill()})),"supergalactic"!==t.transform&&t.background.opacity>.95&&h.selectAll(a+" .mwbg").each((function(e){setStyle(t.background),r(e),Z.fill()}))),t.lines)has(t.lines,c)&&!0===t.lines[c].show&&(setStyle(t.lines[c]),h.selectAll(a+" ."+c).attr("d",r),Z.stroke());if(has(t.lines.graticule,"lon")&&(setTextStyle(t.lines.graticule.lon),h.selectAll(a+" .graticule_lon").each((function(t,a){if(clip(t.geometry.coordinates)){var n=e(t.geometry.coordinates);gridOrientation(n,t.properties.orientation),Z.fillText(t.properties.value,n[0],n[1])}}))),has(t.lines.graticule,"lat")&&(setTextStyle(t.lines.graticule.lat),h.selectAll(a+" .graticule_lat").each((function(t,a){if(clip(t.geometry.coordinates)){var n=e(t.geometry.coordinates);gridOrientation(n,t.properties.orientation),Z.fillText(t.properties.value,n[0],n[1])}}))),t.constellations.bounds&&(h.selectAll(a+" .boundaryline").each((function(e){if(setStyle(t.constellations.boundStyle),i.constellation){var a=new RegExp("\\b"+i.constellation+"\\b");-1!==e.ids.search(a)&&(Z.lineWidth*=1.5,Z.globalAlpha=1,Z.setLineDash([]))}r(e),Z.stroke()})),Z.setLineDash([])),t.constellations.lines&&h.selectAll(a+" .constline").each((function(e){setStyleA(e.properties.rank,t.constellations.lineStyle),r(e),Z.stroke()})),drawOutline(!0),t.constellations.names&&h.selectAll(a+" .constname").each((function(a){if(clip(a.geometry.coordinates)){setStyleA(a.properties.rank,t.constellations.nameStyle);var n=e(a.geometry.coordinates);Z.fillText(function constName(e){return e.properties[t.constellations.namesType]}(a),n[0],n[1])}})),t.stars.show&&(setStyle(t.stars.style),h.selectAll(a+" .star").each((function(a){if(clip(a.geometry.coordinates)&&a.properties.mag<=t.stars.limit){var n=e(a.geometry.coordinates),r=function starSize(t){var e=t.properties.mag;if(null===e)return.1;var a=G*W*Math.exp(U*(e+2));return Math.max(a,.1)}(a);Z.fillStyle=starColor(a),Z.beginPath(),Z.arc(n[0],n[1],r,0,2*Math.PI),Z.closePath(),Z.fill(),t.stars.designation&&a.properties.mag<=t.stars.designationLimit*W&&(setTextStyle(t.stars.designationStyle),Z.fillText(function starDesignation(e){return has(p,e)?p[e][t.stars.designationType]:""}(a.id),n[0]+r,n[1])),t.stars.propername&&a.properties.mag<=t.stars.propernameLimit*W&&(setTextStyle(t.stars.propernameStyle),Z.fillText(function starPropername(e){var a=t.stars.propernameType;return has(p,e)?has(p[e],a)?p[e][a]:p[e].name:""}(a.id),n[0]-r,n[1]))}}))),t.dsos.show&&h.selectAll(a+" .dso").each((function(a){if(clip(a.geometry.coordinates)&&dsoDisplay(a.properties,t.dsos.limit)){var n=e(a.geometry.coordinates),r=a.properties.type;!0===t.dsos.colors?setStyle(t.dsos.symbols[r]):setStyle(t.dsos.style);var s=dsoSymbol(a,n);has(t.dsos.symbols[r],"stroke")?Z.stroke():Z.fill(),t.dsos.names&&dsoDisplay(a.properties,t.dsos.nameLimit*W)&&(setTextStyle(t.dsos.nameStyle),!0===t.dsos.colors&&(Z.fillStyle=t.dsos.symbols[r].fill),Z.fillText(function dsoName(e){var a=t.dsos.namesType,n=e.id;return"desig"!==a&&has(d,n)&&has(d[n],a)?d[n][a]:e.properties.desig}(a),n[0]+s,n[1]-s))}})),(t.location||t.formFields.location)&&t.planets.show&&i.origin){var u=i.date(),f=i.origin(u).spherical();h.selectAll(a+" .planet").each((function(a){var n=a.id(),r=12*W,s=a(u).equatorial(f),o=transformDeg(s.ephemeris.pos,b[t.transform]);if(clip(o)){var i=e(o),l=t.planets.symbols[n];if("letter"===t.planets.symbolType?(setTextStyle(t.planets.symbolStyle),Z.fillStyle=l.fill,Z.fillText(l.letter,i[0],i[1])):"lun"===n?(has(l,"size")&&isNumber(l.size)&&(r=l.size*W),Z.fillStyle=l.fill,j.symbol().type("crescent").size(r*r).age(s.ephemeris.age).position(i)(Z)):"disk"===t.planets.symbolType?(r=has(l,"size")&&isNumber(l.size)?l.size*W:function planetSize(t){var e=t.mag;if(null===e)return 2;var a=4*W*Math.exp(-.05*(e+2));return Math.max(a,2)}(s.ephemeris),Z.fillStyle=l.fill,j.symbol().type("circle").size(r*r).position(i)(Z),Z.fill()):"symbol"===t.planets.symbolType&&(setTextStyle(t.planets.symbolStyle),Z.font=function planetSymbol(t){var e=t.replace(/(^\D*)(\d+)(\D.+$)/i,"$2");return e=Math.round(W*e),t.replace(/(^\D*)(\d+)(\D.+$)/i,"$1"+e+"$3")}(t.planets.symbolStyle.font),Z.fillStyle=l.fill,Z.fillText(l[t.planets.symbolType],i[0],i[1])),t.planets.names){var c=s[t.planets.namesType];setTextStyle(t.planets.nameStyle),Z.fillStyle=l.fill,Z.fillText(c,i[0]-r/2,i[1]+r/2)}}}))}if(i.data.length>0&&i.data.forEach((function(t){t.redraw()})),(t.location||t.formFields.location)&&t.daylight.show&&C.clip){var m=getPlanet("sol");if(m){var y=i.zenith(),g=m.ephemeris.pos,v=d3.geo.distance(y,g),w=e(g);o.origin(g),function setSkyStyle(t,e){var a,n,r,s,o=1.36,i=1.885;if(t>i)return Z.fillStyle="transparent",void(Z.globalAlpha=0);t<=o?(n="#daf1fa",r="#93d7f0",s="#57c0e8",a=-(o-t)/10):(a=(t-o)/(i-o),n=d3.interpolateLab("#daf1fa","#e8c866")(a),r=d3.interpolateLab("#93c7d0","#ff854a")(a),s=d3.interpolateLab("#57b0c8","#6caae2")(a));var l=Z.createRadialGradient(e[0],e[1],0,e[0],e[1],300);l.addColorStop(0,n),l.addColorStop(.2+.4*a,r),l.addColorStop(1,s),Z.fillStyle=l,Z.globalAlpha=.9*(1-function skyTransparency(t,e){return(Math.pow(Math.E,t*e)-1)/(Math.pow(Math.E,e)-1)}(a,1.4))}(v,w),h.selectAll(a+" .daylight").datum(o).attr("d",r),Z.fill(),Z.fillStyle="#fff",clip(g)&&(Z.beginPath(),Z.arc(w[0],w[1],6,0,2*Math.PI),Z.closePath(),Z.fill())}}(t.location||t.formFields.location)&&t.horizon.show&&!C.clip&&(s.origin(i.nadir()),setStyle(t.horizon),h.selectAll(a+" .horizon").datum(s).attr("d",r),Z.fill(),t.horizon.stroke&&Z.stroke()),t.controls&&function zoomState(t){var e=$("celestial-zoomin"),a=$("celestial-zoomout"),n=C.scale*F/1024;if(!e||!a)return;e.disabled=t>=n*l*.99,a.disabled=t<=n}(e.scale()),M&&i.runCallback()}function drawOutline(n){var s=e.rotate();getProjection(t.projection,u.projectionRatio);e.rotate([0,0]),setStyle(t.background),h.selectAll(a+" .outline").attr("d",r),!0===n?(Z.globalAlpha=1,Z.stroke()):Z.fill(),e.rotate(s)}function clip(e){return C.clip&&d3.geo.distance(t.center,e)>g?0:1}function setStyle(t){Z.fillStyle=t.fill||null,Z.strokeStyle=t.stroke||null,Z.lineWidth=t.width||null,Z.globalAlpha=null!==t.opacity?t.opacity:1,Z.font=t.font||null,has(t,"dash")?Z.setLineDash(t.dash):Z.setLineDash([]),Z.beginPath()}function setTextStyle(t){Z.fillStyle=t.fill,Z.textAlign=t.align||"left",Z.textBaseline=t.baseline||"bottom",Z.globalAlpha=null!==t.opacity?t.opacity:1,Z.font=t.font}function setStyleA(t,e){t=t||1,Z.fillStyle=isArray(e.fill)?e.fill[t-1]:null,Z.strokeStyle=isArray(e.stroke)?e.stroke[t-1]:null,Z.lineWidth=isArray(e.width)?e.width[t-1]:null,Z.globalAlpha=isArray(e.opacity)?e.opacity[t-1]:1,Z.font=isArray(e.font)?e.font[t-1]:null,has(e,"dash")?Z.setLineDash(e.dash):Z.setLineDash([]),Z.textAlign=e.align||"left",Z.textBaseline=e.baseline||"bottom",Z.beginPath()}function setClip(t){t?e.clipAngle(90):e.clipAngle(null)}function filename(t,e,a){return t+(e=e?"."+e:"")+(has(T[t],K)?"."+K:"")+(a=a?"."+a:".json")}function dsoDisplay(t,e){return 999===t.mag&&Math.sqrt(parseInt(t.dim))>e||999!==t.mag&&t.mag<=e}function dsoSymbol(e,a){var n=e.properties,r=function dsoSize(t){return t.mag&&999!==t.mag?Math.pow(2*H*W-t.mag,R):Math.pow(parseInt(t.dim)*H*W/7,.5)}(n)||9,s=function dsoShape(e){return e&&has(t.dsos.symbols,e)?t.dsos.symbols[e].shape:"circle"}(n.type);return j.symbol().type(s).size(r).position(a)(Z),Math.sqrt(r)/2}function starColor(e){var a=e.properties.bv;return!t.stars.colors||isNaN(a)?t.stars.style.fill:x(a)}function gridOrientation(t,e){for(var a=e.split(""),n="center",r="middle",s=a.length-1;s>=0;s--)switch(a[s]){case"N":r="bottom";break;case"S":r="top";break;case"E":n="left",t[0]+=2;break;case"W":n="right",t[0]-=2}return Z.textAlign=n,Z.textBaseline=r,t}function getWidth(){return isNumber(t.width)&&t.width>0?t.width:I?I.getBoundingClientRect().width-2*q[0]:window.getBoundingClientRect().width-2*q[0]}function getProjection(t,e){if(has(S,t)){var a=S[t];return has(a,"ratio")||(a.ratio=2),a.ratio=e||a.ratio,a}}function animate(){if(A&&!(A.length<1)){var t,e=A[P];switch(e.param){case"projection":t=reproject({projection:e.value});break;case"center":t=rotate({center:e.value});break;case"zoom":t=zoomBy(e.value)}e.callback&&setTimeout(e.callback,t),P++,!0===D&&P===A.length&&(P=0),t=0===e.duration||e.duration<t?t:e.duration,P<A.length&&(f=setTimeout(animate,t))}}},"object"==typeof module&&module.exports){var u=require("d3.js"),f=require("d3.geo.projection.js");module.exports={Celestial:function(){return i},d3:function(){return u},"d3.geo.projection":function(){return f}}}i.projection=function(t){var e,a,n;if(!has(S,t))throw new Error("Projection not supported: "+t);return e=S[t],a=null!==e.arg?d3.geo[t].raw(e.arg):d3.geo[t].raw,(n=function(t,e){return a(-t,e)}).invert=function(t,e){try{var n=a.invert(t,e);return n[0]=n&&-n[0],n}catch(r){console.log(r)}},d3.geo.projection(n)};var h={equatorial:[0,0,0],ecliptic:[0,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]};i.eulerAngles=function(){return h};var m={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]};i.poles=function(){return m};var y=2*Math.PI,g=Math.PI/2,v=Math.PI/180;function transformDeg(t,e){var a=function transform(t,e){var a,n,r,s,o,i,l,c,p,d,u=1e-5;if(!e)return t;i=t[0],i<0&&(i+=y);l=t[1],i-=e[0],s=e[1],o=e[2],a=Math.sin(l)*Math.sin(s)-Math.cos(l)*Math.cos(s)*Math.cos(i),Math.abs(a)<u&&(a=-Math.cos(l+s)+Math.cos(l)*Math.cos(s)*(1-Math.cos(i)));n=-Math.cos(l)*Math.sin(i),c=0!==a||0!==n?Math.atan2(n,a):i-Math.PI;(p=o+c)>Math.PI&&(p-=y);i%Math.PI==0?((d=l+Math.cos(i)*s)>g&&(d=Math.PI-d),d<-g&&(d=-Math.PI-d)):(r=Math.sin(l)*Math.cos(s)+Math.cos(l)*Math.sin(s)*Math.cos(i),Math.abs(r)>.99?(d=Math.abs(Math.acos(Math.sqrt(a*a+n*n))),r<0&&(d*=-1)):d=Math.asin(r));return[p,d]}(t.map((function(t){return t*v})),e);return a.map((function(t){return t/v}))}function getAngles(t){if(null===t||t.length<=0)return[0,0,0];var e=h.equatorial;return t[2]||(t[2]=0),[e[0]-t[0],e[1]-t[1],e[2]+t[2]]}var b={ecliptic:[-90,23.4393,90],"inverse ecliptic":[90,23.4393,-90],galactic:[-167.1405,62.8717,122.9319],"inverse galactic":[122.9319,62.8717,-167.1405],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[26.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map((function(t){return t*v})))},add:function(t,e){if(e&&t&&3===e.length&&!this.hasOwnProperty(t))return this[t]=e.map((function(t){return t*v})),this[t]}};b.init(),i.euler=function(){return b};var horizontal=function(t,e,a){var n=getMST(t,a[1])-e[0];n<0&&(n+=360),n*=v;var r=e[1]*v,s=a[0]*v,o=Math.asin(Math.sin(r)*Math.sin(s)+Math.cos(r)*Math.cos(s)*Math.cos(n)),i=Math.acos((Math.sin(r)-Math.sin(o)*Math.sin(s))/(Math.cos(o)*Math.cos(s)));return Math.sin(n)>0&&(i=2*Math.PI-i),[o/v,i/v,0]};function getMST(t,e){var a=t.getUTCFullYear(),n=t.getUTCMonth()+1,r=t.getUTCDate(),s=t.getUTCHours(),o=t.getUTCMinutes(),i=t.getUTCSeconds();1!=n&&2!=n||(a-=1,n+=12);var l=Math.floor(a/100),c=2-l+Math.floor(l/4)+Math.floor(365.25*a)+Math.floor(30.6001*(n+1))-730550.5+r+(s+o/60+i/3600)/24,p=c/36525,d=280.46061837+360.98564736629*c+387933e-9*p*p-p*p*p/3871e4+e;if(d>0)for(;d>360;)d-=360;else for(;d<0;)d+=360;return d}horizontal.inverse=function(t,e,a){var n=e[0]*v,r=e[1]*v,s=a[0]*v,o=Math.asin(Math.sin(n)*Math.sin(s)+Math.cos(n)*Math.cos(s)*Math.cos(r)),i=((Math.sin(n)-Math.sin(o)*Math.sin(s))/(Math.cos(o)*Math.cos(s))).toFixed(6);return i=Math.acos(i),i/=v,[getMST(t,a[1])-i,o/v,0]},i.horizontal=horizontal,i.ha=function(t,e,a){var n=getMST(t,e)-a;return n<180&&(n+=360),n};var M=!1;function getData(t,e){if("equatorial"===e)return t;for(var a=b[e],n=t.features,r=0;r<n.length;r++)n[r].geometry.coordinates=translate(n[r],a);return t}function getPlanet(t,e){if(e=e||i.date(),i.origin){var a,n=i.origin(e).spherical();return i.container.selectAll(".planet").each((function(r){t===r.id()&&(a=r(e).equatorial(n))})),a}}function getMwbackground(t){var e={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[]}}]},a=t.features[0].geometry.coordinates[0];e.features[0].geometry.coordinates[0]=[];for(var n=0;n<a.length;n++)e.features[0].geometry.coordinates[0][n]=a[n].slice().reverse();return e}function translate(t,e){var a=[];switch(t.geometry.type){case"Point":a=transformDeg(t.geometry.coordinates,e);break;case"LineString":a.push(transLine(t.geometry.coordinates,e));break;case"MultiLineString":a=transMultiLine(t.geometry.coordinates,e);break;case"Polygon":a.push(transLine(t.geometry.coordinates[0],e));break;case"MultiPolygon":a.push(transMultiLine(t.geometry.coordinates[0],e))}return a}function getGridValues(e,a){var n=[];if(!a)return[];isArray(a)||(a=[a]);for(var r=0;r<a.length;r++)switch(a[r]){case"center":n="lat"===e?n.concat(getLine(e,t.center[0],"N")):n.concat(getLine(e,t.center[1],"S"));break;case"outline":n="lon"===e?(n=n.concat(getLine(e,t.center[1]-89.99,"S"))).concat(getLine(e,t.center[1]+89.99,"N")):(n=n.concat(getLine(e,t.center[0]-179.99,"E"))).concat(getLine(e,t.center[0]+179.99,"W"));break;default:if(isNumber(a[r])){n="lat"===e?n.concat(getLine(e,a[r],"N")):n.concat(getLine(e,a[r],"S"));break}}return function jsonGridValues(t){for(var e=[],a=0;a<t.length;a++){var n={type:"Feature",id:a,properties:{},geometry:{type:"Point"}};n.properties.value=t[a].value,n.properties.orientation=t[a].orientation,n.geometry.coordinates=t[a].coordinates,e.push(n)}return e}(n)}function getLine(e,a,n){var r,s,o,i,l,c=e,p=[],d=a;"equatorial"===t.transform&&"lon"===c&&(c="ra"),"ra"===c?(r=0,s=23,o=1):"lon"===c?(r=0,s=350,o=10):(r=-80,s=80,o=10);for(var u=r;u<=s;u+=o){var f=n;"lat"===c?(l=[d,u],i=u.toString()+"°",f+=u<0?"S":"N"):"ra"===c?(l=[15*u,d],i=u.toString()+"ʰ"):(l=[u,d],i=u.toString()+"°"),p.push({coordinates:l,value:i,orientation:f})}return p}function transLine(t,e){for(var a=[],n=0;n<t.length;n++)a.push(transformDeg(t[n],e));return a}function transMultiLine(t,e){for(var a=[],n=0;n<t.length;n++)a.push(transLine(t[n],e));return a}i.add=function(t){var e={};return has(t,"type")?"dso"!==t.type&&"json"!==t.type||has(t,"file")&&has(t,"callback")?"line"!==t.type&&"raw"!==t.type||has(t,"callback")?(has(t,"file")&&(e.file=t.file),e.type=t.type,has(t,"callback")&&(e.callback=t.callback),has(t,"redraw")&&(e.redraw=t.redraw),has(t,"save")&&(e.save=t.save),void i.data.push(e)):console.log("Can't add data"):console.log("Can't add data file"):console.log("Missing type")},i.remove=function(t){if(null!==t&&t<i.data.length)return i.data.splice(t,1)},i.clear=function(){i.data=[]},i.addCallback=function(t){i.callback=t,M=null!==t},i.runCallback=function(t){M=!1,i.callback(),M=!0},i.getData=getData,i.getPoint=function getPoint(t,e){return transformDeg(t,b[e])},i.getPlanet=getPlanet;var w={},k={width:0,projection:"aitoff",projectionRatio:null,transform:"equatorial",center:null,geopos:null,follow:"zenith",orientationfixed:!0,zoomlevel:null,zoomextend:10,adaptable:!0,interactive:!0,disableAnimations:!1,form:!1,location:!1,formFields:{location:!0,general:!0,stars:!0,dsos:!0,constellations:!0,lines:!0,other:!0,download:!1},advanced:!0,daterange:[],settimezone:!0,timezoneid:"AEFXZPQ3FDPF",controls:!0,lang:"",culture:"",container:"celestial-map",datapath:"data/",stars:{show:!0,limit:6,colors:!0,style:{fill:"#ffffff",opacity:1},designation:!0,designationType:"desig",designationStyle:{fill:"#ddddbb",font:"11px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif",align:"left",baseline:"top"},designationLimit:2.5,propername:!1,propernameType:"name",propernameStyle:{fill:"#ddddbb",font:"13px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif",align:"right",baseline:"bottom"},propernameLimit:1.5,size:7,exponent:-.28,data:"stars.6.json"},dsos:{show:!0,limit:6,colors:!0,style:{fill:"#cccccc",stroke:"#cccccc",width:2,opacity:1},names:!0,namesType:"desig",nameStyle:{fill:"#cccccc",font:"11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, serif",align:"left",baseline:"bottom"},nameLimit:4,size:null,exponent:1.4,data:"dsos.bright.json",symbols:{gg:{shape:"circle",fill:"#ff0000"},g:{shape:"ellipse",fill:"#ff0000"},s:{shape:"ellipse",fill:"#ff0000"},s0:{shape:"ellipse",fill:"#ff0000"},sd:{shape:"ellipse",fill:"#ff0000"},e:{shape:"ellipse",fill:"#ff0000"},i:{shape:"ellipse",fill:"#ff0000"},oc:{shape:"circle",fill:"#ff9900",stroke:"#ff9900",width:2},gc:{shape:"circle",fill:"#ff9900"},en:{shape:"square",fill:"#ff00cc"},bn:{shape:"square",fill:"#ff00cc"},sfr:{shape:"square",fill:"#cc00ff"},rn:{shape:"square",fill:"#0000ff"},pn:{shape:"diamond",fill:"#00cccc"},snr:{shape:"diamond",fill:"#ff00cc"},dn:{shape:"square",fill:"#999999",stroke:"#999999",width:2},pos:{shape:"marker",fill:"#cccccc",stroke:"#cccccc",width:1.5}}},constellations:{show:!0,names:!0,namesType:"desig",nameStyle:{fill:"#cccc99",align:"center",baseline:"middle",opacity:.8,font:["14px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif","12px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif","11px 'Lucida Sans Unicode', 'DejaVu Sans', Helvetica, Arial, sans-serif"]},lines:!0,lineStyle:{stroke:"#cccccc",width:1.5,opacity:.6},bounds:!1,boundStyle:{stroke:"#ccff00",width:1,opacity:.8,dash:[4,4]}},mw:{show:!0,style:{fill:"#ffffff",opacity:"0.15"}},lines:{graticule:{show:!0,stroke:"#cccccc",width:.6,opacity:.8,lon:{pos:[],fill:"#eee",font:"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"},lat:{pos:[],fill:"#eee",font:"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"}},equatorial:{show:!0,stroke:"#aaaaaa",width:1.3,opacity:.7},ecliptic:{show:!0,stroke:"#66cc66",width:1.3,opacity:.7},galactic:{show:!1,stroke:"#cc6666",width:1.3,opacity:.7},supergalactic:{show:!1,stroke:"#cc66cc",width:1.3,opacity:.7}},background:{fill:"#880000",opacity:0,stroke:"#000000",width:1.5},horizon:{show:!1,stroke:"#cccccc",width:.3,fill:"#000000",opacity:.4},daylight:{show:!1},planets:{show:!1,which:["sol","mer","ven","ter","lun","mar","jup","sat","ura","nep","cer","plu"],symbols:{sol:{symbol:"☉",letter:"Sol",fill:"#fffc00"},mer:{symbol:"☿",letter:"M",fill:"#7182a0"},ven:{symbol:"♀",letter:"V",fill:"#dea6cc"},ter:{symbol:"⊕",letter:".",fill:"#0914f0"},lun:{symbol:"●",letter:"Moon",fill:"#bababa"},mar:{symbol:"♂",letter:"M",fill:"#b9041e"},cer:{symbol:"⚳",letter:"c",fill:"#6e6869"},ves:{symbol:"⚶",letter:"v",fill:"#6e6869"},jup:{symbol:"♃",letter:"J",fill:"#f08033"},sat:{symbol:"♄",letter:"S",fill:"#db9d3b"},ura:{symbol:"♅",letter:"U",fill:"#20a7ec"},nep:{symbol:"♆",letter:"N",fill:"#44a0cf"},plu:{symbol:"♇",letter:"p",fill:"#eab7ec"},eri:{symbol:"⚪",letter:"e",fill:"#d7ccd7"}},symbolStyle:{fill:"#cccccc",opacity:1,font:"bold 20px 'DejaVu Sans Mono', 'Arial Unicode MS', sans-serif",align:"center",baseline:"middle"},symbolType:"symbol",names:!1,nameStyle:{fill:"#cccccc",font:"14px 'Lucida Sans Unicode', 'DejaVu Sans', sans-serif",align:"right",baseline:"top"},namesType:"en"},set:function(t){var e,a,n={},r={};if(0===Object.entries(w).length?Object.assign(n,this):Object.assign(n,w),!t)return n;for(e in n)if(has(n,e))if(has(t,e)&&null!==t[e])if(null===n[e]||n[e].constructor!=Object)r[e]=t[e];else for(a in r[e]={},n[e])has(t[e],a)?r[e][a]=t[e][a]:r[e][a]=n[e][a];else r[e]=n[e];return r.constellations.nameStyle.font=arrayfy(r.constellations.nameStyle.font),r.constellations.nameStyle.opacity=arrayfy(r.constellations.nameStyle.opacity),r.constellations.nameStyle.fill=arrayfy(r.constellations.nameStyle.fill),r.constellations.lineStyle.width=arrayfy(r.constellations.lineStyle.width),r.constellations.lineStyle.opacity=arrayfy(r.constellations.lineStyle.opacity),r.constellations.lineStyle.stroke=arrayfy(r.constellations.lineStyle.stroke),Object.assign(w,r),r},applyDefaults:function(t){var e={};return Object.assign(e,w),e.stars.size=e.stars.size||7,e.stars.exponent=e.stars.exponent||-.28,(!e.center||e.center.length<=0)&&(e.center=[0,0,0]),e.datapath=e.datapath||"",e.datapath=e.datapath.replace(/([^\/]$)/,"$1/"),e.transform&&""!==e.transform||(e.transform="equatorial"),e.culture&&-1!==e.culture.search(/^cn$/)||(e.culture="iau"),t&&(has(t,"stars")&&(has(t.stars,"names")&&(e.stars.designation=t.stars.names),has(t.stars,"namelimit")&&(e.stars.designationLimit=t.stars.namelimit),has(t.stars,"namestyle")&&Object.assign(e.stars.designationStyle,t.stars.namestyle),has(t.stars,"proper")&&(e.stars.propername=t.stars.proper),has(t.stars,"propernamelimit")&&(e.stars.propernameLimit=t.stars.propernamelimit),has(t.stars,"propernamestyle")&&Object.assign(e.stars.propernameStyle,t.stars.propernamestyle)),has(t,"dsos")&&(has(t.dsos,"desig")&&!0===t.dsos.desig&&(e.dsos.namesType="desig"),has(t.dsos,"namelimit")&&(e.dsos.nameLimit=t.dsos.namelimit),has(t.dsos,"namestyle")&&Object.assign(e.dsos.nameStyle,t.dsos.namestyle)),has(t,"constellations")&&(has(t.constellations,"show")&&!0===t.constellations.show&&(e.constellations.names=!0),has(t.constellations,"desig")&&!0===t.constellations.desig&&(e.constellations.namesType="desig"),"latin"===e.constellations.namesType&&(e.constellations.namesType="la"),"iau"===e.constellations.namesType&&(e.constellations.namesType="name"),has(t.constellations,"namestyle")&&Object.assign(e.constellations.nameStyle,t.constellations.namestyle),has(t.constellations,"linestyle")&&Object.assign(e.constellations.lineStyle,t.constellations.linestyle),has(t.constellations,"boundstyle")&&Object.assign(e.constellations.boundStyle,t.constellations.boundstyle)),has(t,"planets")&&has(t.planets,"style")&&Object.assign(e.planets.style,t.planets.symbolStyle)),e.stars.designationType&&""!==e.stars.designationType||(e.stars.designationType="desig"),has(T.starnames[e.culture].designation,e.stars.designationType)||(e.designationType="desig"),e.stars.propernameType&&""!==e.stars.propernameType||(e.stars.propernameType="name"),has(T.starnames[e.culture].propername,e.stars.propernameType)||(e.propernameType="name"),e.dsos.namesType&&""!==e.dsos.namesType||(e.dsos.namesType="desig"),e.constellations.namesType&&""!==e.constellations.namesType||(e.constellations.namesType="desig"),has(T.constellations[e.culture].names,e.constellations.namesType)||(e.constellations.namesType="name"),e.planets.symbolType&&""!==e.planets.symbolType||(e.planets.symbolType="symbol"),e.planets.namesType&&""!==e.planets.namesType||(e.planets.namesType="desig"),has(T.planets[e.culture].names,e.planets.namesType)||(e.planets.namesType="desig"),e.constellations.nameStyle.font=arrayfy(e.constellations.nameStyle.font),e.constellations.nameStyle.opacity=arrayfy(e.constellations.nameStyle.opacity),e.constellations.nameStyle.fill=arrayfy(e.constellations.nameStyle.fill),e.constellations.lineStyle.width=arrayfy(e.constellations.lineStyle.width),e.constellations.lineStyle.opacity=arrayfy(e.constellations.lineStyle.opacity),e.constellations.lineStyle.stroke=arrayfy(e.constellations.lineStyle.stroke),Object.assign(w,e),e}};function arrayfy(t){return isArray(t)?t.length>=3?t:1===t.length?[t[0],t[0],t[0]]:2===t.length?[t[0],t[1],t[1]]:void 0:[t,t,t]}i.settings=function(){return k};var x=d3.scale.quantize().domain([3.347,-.335]).range(["#ff4700","#ff4b00","#ff4f00","#ff5300","#ff5600","#ff5900","#ff5b00","#ff5d00","#ff6000","#ff6300","#ff6500","#ff6700","#ff6900","#ff6b00","#ff6d00","#ff7000","#ff7300","#ff7500","#ff7800","#ff7a00","#ff7c00","#ff7e00","#ff8100","#ff8300","#ff8506","#ff870a","#ff8912","#ff8b1a","#ff8e21","#ff9127","#ff932c","#ff9631","#ff9836","#ff9a3c","#ff9d3f","#ffa148","#ffa34b","#ffa54f","#ffa753","#ffa957","#ffab5a","#ffad5e","#ffb165","#ffb269","#ffb46b","#ffb872","#ffb975","#ffbb78","#ffbe7e","#ffc184","#ffc489","#ffc78f","#ffc892","#ffc994","#ffcc99","#ffce9f","#ffd1a3","#ffd3a8","#ffd5ad","#ffd7b1","#ffd9b6","#ffdbba","#ffddbe","#ffdfc2","#ffe1c6","#ffe3ca","#ffe4ce","#ffe8d5","#ffe9d9","#ffebdc","#ffece0","#ffefe6","#fff0e9","#fff2ec","#fff4f2","#fff5f5","#fff6f8","#fff9fd","#fef9ff","#f9f6ff","#f6f4ff","#f3f2ff","#eff0ff","#ebeeff","#e9edff","#e6ebff","#e3e9ff","#e0e7ff","#dee6ff","#dce5ff","#d9e3ff","#d7e2ff","#d3e0ff","#c9d9ff","#bfd3ff","#b7ceff","#afc9ff","#a9c5ff","#a4c2ff","#9fbfff","#9bbcff"]),S={airy:{n:"Airy’s Minimum Error",arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{n:"Aitoff",arg:null,scale:162},armadillo:{n:"Armadillo",arg:0,scale:250},august:{n:"August",arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{n:"Azimuthal Equal Area",arg:null,scale:340,ratio:1,clip:!0},azimuthalEquidistant:{n:"Azimuthal Equidistant",arg:null,scale:320,ratio:1,clip:!0},baker:{n:"Baker Dinomic",arg:null,scale:160,ratio:1.4},berghaus:{n:"Berghaus Star",arg:0,scale:320,ratio:1,clip:!0},boggs:{n:"Boggs Eumorphic",arg:null,scale:170},bonne:{n:"Bonne",arg:Math.PI/2.5,scale:225,ratio:.88},bromley:{n:"Bromley",arg:null,scale:162},butterfly:{n:"Butterfly",arg:null,scale:31,ratio:1.1,clip:!0},cassini:{n:"Cassini",arg:null,scale:325,ratio:1,clip:!0},collignon:{n:"Collignon",arg:null,scale:100,ratio:2.6},craig:{n:"Craig Retroazi
